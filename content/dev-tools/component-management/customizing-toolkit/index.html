<head> <title>Customization - Exadel Authoring Kit</title> <link rel="canonical" href="https://authoring-kit.com/content/dev-tools/component-management/customizing-toolkit"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width,initial-scale=1"> <link rel="icon" type="image/png" href="/assets/logo-64x64.png"> <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-SFSRZREMCC"></script> <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-SFSRZREMCC")</script> <script>!function(){var e="";"getRootNode"in Element.prototype&&window.customElements?window.scrollBy&&window.IntersectionObserver&&window.ResizeObserver&&window.ResizeObserver||(e="light"):e="medium",e&&document.write('<script type="text/javascript" src="/bundles/polyfill-'+e+'.js"><\/script>')}()</script> <link rel="stylesheet" type="text/css" href="/bundles/site.css"> </head> <body> <div class="page sidebar-layout"> <header class="header"> <nav class="header-container container"> <a class="header-link header-logo logo-animated" href="/" aria-label="landing page"> <svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 38 38"> <g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#0082CA"> <path d="M23.7024 17.967a1.4253 1.4253 0 0 0 1.4276.7264 1.4273 1.4273 0 0 0 1.2019-1.0588 1.4265 1.4265 0 0 0-.16-1.0926L20.3532 6.4634A1.4044 1.4044 0 0 0 19 5.762a1.427 1.427 0 0 0-1.354.7014L6.9582 24.9731a1.4257 1.4257 0 0 0 .5227 1.9477 1.424 1.424 0 0 0 .527.1786 1.4243 1.4243 0 0 0 1.054-.2829 1.4253 1.4253 0 0 0 .3667-.4184L19 9.8206l4.7024 8.1464Z"></path> <path d="m31.0418 24.8667-2.2336-3.8608a1.399 1.399 0 0 0-.6642-.5941 1.4256 1.4256 0 0 0-.7608-.2253H15.7457a1.4251 1.4251 0 0 0 0 2.85h10.9512l1.8763 3.2534a1.426 1.426 0 0 0 2.5758-.3632 1.4255 1.4255 0 0 0-.1072-1.06Z"></path> <path d="M38 19C38 8.5029 29.4971 0 19 0S0 8.5029 0 19s8.502 19 19 19a18.859 18.859 0 0 0 8.134-1.8311 1.4094 1.4094 0 0 1-.7599-1.2113 17.567 17.567 0 0 1-7.3599 1.6148c-9.7017 0-17.575-7.8724-17.575-17.5751C1.4392 9.2947 9.2982 1.425 19 1.425c9.7017 0 17.575 7.876 17.575 17.575a17.4351 17.4351 0 0 1-3.1594 10.0467 1.4199 1.4199 0 0 1 .5471 1.1164v.5462A18.924 18.924 0 0 0 38 19Z"></path> <path d="M32.3001 29.6877h-4.2732a.7133.7133 0 0 0 0 1.4268h3.562v1.1873a.7125.7125 0 0 0 1.425 0v-1.8967a.7159.7159 0 0 0-.2081-.5068.7143.7143 0 0 0-.5057-.2106ZM32.0624 33.9627h-3.3261v-1.425a.7125.7125 0 1 0-1.425 0v2.1379a.7147.7147 0 0 0 .7094.7094h4.0373a.7125.7125 0 0 0 0-1.425l.0044.0027Z"></path> </g> <defs> <clipPath id="a"> <path fill="#fff" d="M0 0h38v38H0z"></path> </clipPath> </defs> </svg> <span class="header-short-name">Exadel Authoring Kit</span> <span class="header-long-name">Exadel Authoring Kit for AEM</span> </a> <ul class="header-links unstyled-list"> <li class="header-item"> <a class="header-link" href=".">Manuals</a> </li> <li class="header-item"> <a class="header-link" href="" target="_blank">API Docs</a> </li> <li class="header-item"> <a class="header-link" href="" target="_blank">Blog</a> </li> <li class="header-item"> <a class="header-link fill-primary" href="https://github.com/exadel-inc/etoolbox-authoring-kit" target="_blank" rel="noopener norefferer"> <svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"> <path d="M10.6666 14.6668v-2.58a2.246 2.246 0 0 0-.6266-1.74c2.0933-.2333 4.2933-1.0267 4.2933-4.6667a3.6268 3.6268 0 0 0-1-2.5 3.38 3.38 0 0 0-.06-2.5133s-.7867-.2333-2.6067.9867a8.92 8.92 0 0 0-4.6666 0C4.18.4335 3.3933.6668 3.3933.6668a3.38 3.38 0 0 0-.06 2.5133 3.6267 3.6267 0 0 0-1 2.52c0 3.6133 2.2 4.4067 4.2934 4.6667A2.2458 2.2458 0 0 0 6 12.0868v2.58" fill="#0082CA"></path> <path d="M6 12.6668c-3.3333 1-3.3333-1.6667-4.6667-2m9.3333 4v-2.58a2.246 2.246 0 0 0-.6266-1.74c2.0933-.2333 4.2933-1.0267 4.2933-4.6667a3.6268 3.6268 0 0 0-1-2.5 3.38 3.38 0 0 0-.06-2.5133s-.7867-.2333-2.6067.9867a8.92 8.92 0 0 0-4.6666 0C4.18.4335 3.3933.6668 3.3933.6668a3.38 3.38 0 0 0-.06 2.5133 3.6267 3.6267 0 0 0-1 2.52c0 3.6133 2.2 4.4067 4.2934 4.6667A2.2458 2.2458 0 0 0 6 12.0868v2.58h4.6666Z" stroke="#0082CA" stroke-linecap="round" stroke-linejoin="round"></path> </svg> </a> </li> </ul> <div class="header-utility"> <esl-trigger class="header-hamburger" target="#sidebar" aria-label="navigation menu"></esl-trigger> </div> </nav> </header> <eak-sidebar id="sidebar" class="open" aria-label="Site Navigation"> <nav class="sidebar-nav"> <a class="sidebar-heading" href="/"> <span class="sidebar-logo"> <svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 38 38"> <g clip-path="url(#a)" fill-rule="evenodd" clip-rule="evenodd" fill="#0082CA"> <path d="M23.7024 17.967a1.4253 1.4253 0 0 0 1.4276.7264 1.4273 1.4273 0 0 0 1.2019-1.0588 1.4265 1.4265 0 0 0-.16-1.0926L20.3532 6.4634A1.4044 1.4044 0 0 0 19 5.762a1.427 1.427 0 0 0-1.354.7014L6.9582 24.9731a1.4257 1.4257 0 0 0 .5227 1.9477 1.424 1.424 0 0 0 .527.1786 1.4243 1.4243 0 0 0 1.054-.2829 1.4253 1.4253 0 0 0 .3667-.4184L19 9.8206l4.7024 8.1464Z"></path> <path d="m31.0418 24.8667-2.2336-3.8608a1.399 1.399 0 0 0-.6642-.5941 1.4256 1.4256 0 0 0-.7608-.2253H15.7457a1.4251 1.4251 0 0 0 0 2.85h10.9512l1.8763 3.2534a1.426 1.426 0 0 0 2.5758-.3632 1.4255 1.4255 0 0 0-.1072-1.06Z"></path> <path d="M38 19C38 8.5029 29.4971 0 19 0S0 8.5029 0 19s8.502 19 19 19a18.859 18.859 0 0 0 8.134-1.8311 1.4094 1.4094 0 0 1-.7599-1.2113 17.567 17.567 0 0 1-7.3599 1.6148c-9.7017 0-17.575-7.8724-17.575-17.5751C1.4392 9.2947 9.2982 1.425 19 1.425c9.7017 0 17.575 7.876 17.575 17.575a17.4351 17.4351 0 0 1-3.1594 10.0467 1.4199 1.4199 0 0 1 .5471 1.1164v.5462A18.924 18.924 0 0 0 38 19Z"></path> <path d="M32.3001 29.6877h-4.2732a.7133.7133 0 0 0 0 1.4268h3.562v1.1873a.7125.7125 0 0 0 1.425 0v-1.8967a.7159.7159 0 0 0-.2081-.5068.7143.7143 0 0 0-.5057-.2106ZM32.0624 33.9627h-3.3261v-1.425a.7125.7125 0 1 0-1.425 0v2.1379a.7147.7147 0 0 0 .7094.7094h4.0373a.7125.7125 0 0 0 0-1.425l.0044.0027Z"></path> </g> <defs> <clipPath id="a"> <path fill="#fff" d="M0 0h38v38H0z"></path> </clipPath> </defs> </svg> </span> <span class="sidebar-title">Exadel Authoring Kit for AEM</span> </a> <div class="sidebar-content"> <div class="sidebar-scrollable-content esl-scrollable-content"> <ul class="sidebar-nav-list"> <li class="sidebar-nav-item"> <div class="sidebar-nav-item-heading"> Getting Started </div> <div class="sidebar-nav-secondary"> <ul class="sidebar-nav-secondary-list"> <li class="sidebar-nav-secondary-item"> <a class="sidebar-nav-secondary-link" href="/content/getting-started/installation/"> Installation </a> </li> <li class="sidebar-nav-secondary-item"> <a class="sidebar-nav-secondary-link" href="/content/getting-started/common-use-cases/"> Common Use Cases </a> </li> <li class="sidebar-nav-secondary-item"> <a class="sidebar-nav-secondary-link" href="/content/getting-started/popular-articles/"> Popular Articles </a> </li> </ul> </div> </li> <li class="sidebar-nav-item"> <div class="sidebar-nav-item-heading"> Developer Tools </div> <div class="sidebar-nav-secondary"> <ul class="sidebar-nav-secondary-list"> <li class="sidebar-nav-secondary-item sidebar-secondary-nav-item-children"> <div class="sidebar-nav-item-heading active"> <esl-trigger class="sidebar-nav-item-trigger sidebar-nav-item-arrow" target="::parent::next" active=""> Component Management </esl-trigger> </div> <esl-panel id="sidebar-component-management-menu" class="sidebar-nav-secondary nav-secondary-panel open" data-open="" group=" component-management"> <ul class="sidebar-nav-secondary-list"> <li class="sidebar-nav-secondary-item"> <a class="sidebar-nav-secondary-link" href="/content/dev-tools/component-management/component-structure/"> Component Structure </a> </li> <li class="sidebar-nav-secondary-item"> <a class="sidebar-nav-secondary-link" href="/content/dev-tools/component-management/dialog-layout/"> Dialog Layout </a> </li> <li class="sidebar-nav-secondary-item sidebar-secondary-nav-item-children"> <div class="sidebar-nav-item-heading"> <esl-trigger class="sidebar-nav-item-trigger sidebar-nav-item-arrow" target="::parent::next"> Dialog Fields </esl-trigger> </div> <esl-panel id="sidebar-dialog-fields-menu" class="sidebar-nav-secondary nav-secondary-panel" group=" dialog-fields"> <ul class="sidebar-nav-secondary-list"> <li class="sidebar-nav-secondary-item"> <a class="sidebar-nav-secondary-link" href="/content/dev-tools/component-management/dialog-fields/dialog-field/"> Dialog Field </a> </li> <li class="sidebar-nav-secondary-item"> <a class="sidebar-nav-secondary-link" href="/content/dev-tools/component-management/dialog-fields/widgets/"> Widgets (A-Z) </a> </li> <li class="sidebar-nav-secondary-item"> <a class="sidebar-nav-secondary-link" href="/content/dev-tools/component-management/dialog-fields/configuring-rte/"> Configuring RTE </a> </li> <li class="sidebar-nav-secondary-item"> <a class="sidebar-nav-secondary-link" href="/content/dev-tools/component-management/dialog-fields/configuring-fieldset/"> Configuring Fieldset </a> </li> <li class="sidebar-nav-secondary-item"> <a class="sidebar-nav-secondary-link" href="/content/dev-tools/component-management/dialog-fields/configuring-multifield/"> Configuring Multifield </a> </li> </ul> </esl-panel> </li> <li class="sidebar-nav-secondary-item"> <a class="sidebar-nav-secondary-link" href="/content/dev-tools/component-management/additional-properties/"> Additional Properties </a> </li> <li class="sidebar-nav-secondary-item"> <a class="sidebar-nav-secondary-link" href="/content/dev-tools/component-management/reusing-code/"> Reusing Code </a> </li> <li class="sidebar-nav-secondary-item active" aria-selected="true"> <a class="sidebar-nav-secondary-link" aria-current="page" href="/content/dev-tools/component-management/customizing-toolkit/"> Customization </a> </li> </ul> </esl-panel> </li> <li class="sidebar-nav-secondary-item sidebar-secondary-nav-item-children"> <div class="sidebar-nav-item-heading"> <esl-trigger class="sidebar-nav-item-trigger sidebar-nav-item-arrow" target="::parent::next"> DependsOn </esl-trigger> </div> <esl-panel id="sidebar-depends-on-menu" class="sidebar-nav-secondary nav-secondary-panel" group=" depends-on"> <ul class="sidebar-nav-secondary-list"> <li class="sidebar-nav-secondary-item"> <a class="sidebar-nav-secondary-link" href="/content/dev-tools/depends-on/introduction/"> Introduction </a> </li> <li class="sidebar-nav-secondary-item"> <a class="sidebar-nav-secondary-link" href="/content/dev-tools/depends-on/usage/"> Usage </a> </li> <li class="sidebar-nav-secondary-item"> <a class="sidebar-nav-secondary-link" href="/content/dev-tools/depends-on/api/"> API </a> </li> <li class="sidebar-nav-secondary-item"> <a class="sidebar-nav-secondary-link" href="/content/dev-tools/depends-on/examples/"> Examples </a> </li> </ul> </esl-panel> </li> <li class="sidebar-nav-secondary-item"> <a class="sidebar-nav-secondary-link" href="/content/dev-tools/option-provider/"> Option Provider </a> </li> <li class="sidebar-nav-secondary-item"> <a class="sidebar-nav-secondary-link" href="/content/dev-tools/injectors/"> Injectors </a> </li> <li class="sidebar-nav-secondary-item"> <a class="sidebar-nav-secondary-link" href="/content/dev-tools/allowed-components/"> Allowed Components </a> </li> </ul> </div> </li> <li class="sidebar-nav-item"> <div class="sidebar-nav-item-heading"> Authoring Tools </div> <div class="sidebar-nav-secondary"> <ul class="sidebar-nav-secondary-list"> <li class="sidebar-nav-secondary-item"> <a class="sidebar-nav-secondary-link" href="/content/authoring-tools/etoolbox-lists/"> Etoolbox Lists </a> </li> </ul> </div> </li> </ul> <div class="sidebar-footer-copyright"> EAK v2.4.1 © 2024<a class="sidebar-footer-link" href="https://exadel.com/" target="_blank" rel="noopener norefferer">Exadel</a>, Inc. </div> </div> <esl-scrollbar class="sidebar-scrollbar" target="::prev"></esl-scrollbar> </div> </nav> </eak-sidebar> <main class="esl-scrollable-content"> <div class="content mb-4 container markdown-container"> <div class="content-page-title"> <span class="parent-page">Developer Tools / </span> <span class="parent-page">Component Management / </span> <h1 class="current-page">Customizing the ToolKit to your needs</h1> </div> <h2 id="custom-annotations.-annotation-scopes">Custom annotations. Annotation scopes</h2> <p>When creating markup for the Granite UI, the ToolKit handles data from the project's source code. Often it comes from Java annotations like <code>@AemComponent</code>, <code>@EditConfig</code>, or, e.g., <code>@DatePicker</code>.</p> <p>You can create such annotations yourself. In the most basic case, you only need to declare an arbitrary annotation and attach the <code>@AnnotationRendering</code> meta-annotation.</p> <p><code>@AnnotationRendering</code> allows specifying what properties will be automatically mapped to the underlying node's attributes and in what <em>scope</em>.</p> <h3 id="custom-annotation-scope">Custom annotation scope</h3> <p>The notion of <em>scope</em> refers to the region of a component in which the current annotation/handler is effective. The most common scopes are enumerated in the <code>Scopes</code> class. These are the component scope (roughly maps to the <em>.content.xml</em> file in a component's folder as we see in the project source files), <em>&lt;cq:dialog&gt;</em>, <em>&lt;cq:design_dialog&gt;</em>, <em>&lt;cq:editConfig&gt;</em>, <em>&lt;cq:childEditConfig&gt;</em>, <em>&lt;cq:htmlTag&gt;</em>. There can be custom scopes for specific cases. Whenever the scope is not specified, the default (or "all-included") scope is assumed.</p> <p>Consider the following example:</p> <pre><code class="language-java">
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AnnotationRendering</span><span class="token punctuation">(</span>
    scope <span class="token operator">=</span> <span class="token class-name">Scopes</span><span class="token punctuation">.</span><span class="token constant">CQ_DIALOG</span><span class="token punctuation">,</span>
    prefix <span class="token operator">=</span> <span class="token string">"some:"</span>
<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">CustomDialogAnnotation</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> <span class="token function">field1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">""</span><span class="token punctuation">;</span>

    <span class="token keyword">long</span> <span class="token function">field2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">boolean</span> <span class="token function">field3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">field4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@AemComponent</span><span class="token punctuation">(</span>
    path <span class="token operator">=</span> <span class="token string">"path/to/my/component"</span><span class="token punctuation">,</span>
    title <span class="token operator">=</span> <span class="token string">"My AEM Component"</span>
<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Dialog</span>
<span class="token annotation punctuation">@CustomDialogAnnotation</span><span class="token punctuation">(</span>
    field1 <span class="token operator">=</span> <span class="token string">"value1"</span><span class="token punctuation">,</span>
    field2 <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">,</span>
    field3 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    field4 <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span>
<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token punctuation">{</span><span class="token comment">/* ... */</span>
<span class="token punctuation">}</span>
</code></pre> <p>In this sample, the ToolKit essentially creates two Granite nodes: one that would be represented by <em>.content.xml</em> in the project's source code and one represented by <em>_cq_dialog.xml</em>. The former is based on <code>@AemComponent</code> and the latter on <code>@Dialog</code> because this is the default functionality of the ToolKit.</p> <p>The <code>@CustomDialogAnnotation</code> will also affect the Granite UI markup. Its <code>@AnnotationRendering</code> meta-annotation determines that it will affect only the <em>_cq_dialog.xml</em> as follows from <code>scope = Scopes.CQ_DIALOG</code> (be aware that the <em>scope</em> property can also accept an array of values).</p> <p>You can omit the <em>scope</em> property. Then the appropriate scope will be decided on from other annotations attached to the current class. That is, if the class is <code>@Dialog</code>-annotated and a custom annotation is missing a <em>scope</em>, it is assumed that the custom annotation is also bound to the dialog scope. But if the class has its <code>@EditConfig</code> specified but no <code>@Dialog</code>, it is assumed that the custom annotation is within the <em>&lt;cq:editConfig&gt;</em> scope, etc.</p> <h3 id="how-to-control-the-automapping">How to control the automapping</h3> <p>From <code>@CustomDialogAnnotation</code>, the following property values will be automatically mapped: <em>field1</em>, <em>field2</em>, and <em>field3</em>. That is because they have the "mappable" property type. Automatic mapping works for <code>string</code>s (and string arrays); <code>long</code>s (and long arrays), <code>double</code>s (and double arrays), <code>boolean</code>s (and boolean arrays); <code>enum</code> types (ane enum arrays). However, it does not work for <code>Class&lt;?&gt;</code>-typed properties or annotation types.</p> <p>There is a way to restrict automatic mapping to particular properties by specifying them in the following way: <code>@AnnotationRendering(properties = {"field1", "field2"})</code>. You can also turn off automapping completely without removing <code>@AnnotationRendering</code>. To do this you specify <code>@AnnotationRendering(value = {})</code> or <code>@AnnotationRendering(value = "none")</code>.</p> <p>You can also set a prefix for all the properties rendered via the current annotation. Just use <code>@AnnotationRendering(prefix="some_value")</code>.</p> <h3 id="propertyrendering">@PropertyRendering</h3> <p>More settings for the mapping flow can be defined at the individual property level. See the following example:</p> <pre><code class="language-java">
<span class="token annotation punctuation">@AnnotationRendering</span><span class="token punctuation">(</span>properties <span class="token operator">=</span> <span class="token string">"all"</span><span class="token punctuation">)</span> <span class="token comment">// "all" is implied by default but added here for readability</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">CustomAnnotation</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@PropertyRendering</span><span class="token punctuation">(</span>
        name <span class="token operator">=</span> <span class="token string">"some:text"</span><span class="token punctuation">,</span>
        scope <span class="token operator">=</span> <span class="token class-name">Scopes</span><span class="token punctuation">.</span><span class="token constant">CQ_DIALOG</span><span class="token punctuation">,</span>
        allowBlank <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        transform <span class="token operator">=</span> <span class="token class-name">StringTransformation</span><span class="token punctuation">.</span><span class="token constant">CAPITALIZE</span>
    <span class="token punctuation">)</span>
    <span class="token class-name">String</span> <span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PropertyRendering</span><span class="token punctuation">(</span>
        name <span class="token operator">=</span> <span class="token string">"some:checked"</span><span class="token punctuation">,</span>
        ignoreValues <span class="token operator">=</span> <span class="token string">"false"</span><span class="token punctuation">,</span>
        valueType <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">boolean</span> <span class="token function">checked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <p><em>name</em> is used to alter the attribute's name in JCR (in particular, to use a prefixed name or to prepend a namespace). On the contrary,<em>ignorePrefix</em> allows for stripping off a name prefix if it was defined at an upper level (e.g., in the FieldSet).</p> <p><em>scope</em> can be specified to define what JCR node (XML file) will contain this particular property. Useful to distribute properties between, e.g., <em>_content.xml</em> and <em>_cq_dialog.xml</em> files.</p> <p><em>allowBlank</em> determines that even empty or blank property values will be rendered (default behavior is to skip them). On the contrary, <em>ignoreValues</em> ensures that a particular non-blank value (or an array of values) will be skipped as the negligible default. <em>ignoreValues</em> accepts strings like <code>"42"</code> or <code>"false"</code> to ensure that even a numeric or boolean value matching the string can be skipped.</p> <p><em>transform</em> is primarily useful for <code>enum</code>-typed arguments. It provides a way to, for example, render Java enum values in lowercase, which is the standard for Granite settings. Important: if an enum value is set to be skipped via <em>ignoreValues</em>, specify the already transformed writing and not the original.</p> <p><em>valueType</em> allows you to control how a value is stored in JCR. For example, a value of type <code>boolean</code> would be by default rendered as <code>{Boolean}true</code> or <code>{Boolean}false</code>. If you need the type hint skipped, make the ToolKit perceive the value as a string by specifying <code>valueType = String.class</code>.</p> <h2 id="custom-handlers">Custom handlers</h2> <p>ToolKit annotations are rendered with <em>Handlers</em> (even an automatically mapped annotation is processed via an undercover "automapping handler"). All the out-of-box annotations are supplemented with bundled handlers, but you can declare custom ones as well.</p> <p>Here is an example of how a custom handler can look:</p> <pre><code class="language-java">
<span class="token annotation punctuation">@Handles</span><span class="token punctuation">(</span>
    value <span class="token operator">=</span> <span class="token class-name">MultiField</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
    scope <span class="token operator">=</span> <span class="token class-name">Scopes</span><span class="token punctuation">.</span><span class="token constant">CQ_DIALOG</span><span class="token punctuation">,</span>
    before <span class="token operator">=</span> <span class="token class-name">MyCustomHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
    after <span class="token operator">=</span> <span class="token class-name">MyAnotherCustomHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span>
<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CustomMultifieldHandler</span> <span class="token keyword">implements</span> <span class="token class-name">Handler</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">Source</span> source<span class="token punctuation">,</span> <span class="token class-name">Target</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">.</span><span class="token function">attribute</span><span class="token punctuation">(</span><span class="token string">"multifieldSpecial"</span><span class="token punctuation">,</span> <span class="token string">"This is added to MultiFields"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <p>Every custom handler is characterized by the following features:</p> <ol> <li>Marked with the <code>@Handles</code> annotation;</li> <li>Implements <code>Handler</code>;</li> <li>Overrides the <code>accept(Source, Target)</code> method in which the payload logic is run.</li> </ol> <p>Usually, the ToolKit initializes one instance of every handler and manages it as a <em>singleton</em>, so a developer is expected to avoid assigning handler-wide <em>states</em>. All the logic should be processed within the <code>accept(Source, Target)</code>method or in methods called from the latter.</p> <h3 id="handles">@Handles</h3> <p><code>@Handles</code> is the marker of a handler. This annotation exposes the following properties.</p> <p><em>value</em> is a single <code>Class</code> reference or an array of classes. The classes are indeed the annotation types. This setting determines what annotations of a component class or its member will trigger the execution of the current handler.</p> <p>There is no restriction regarding what annotations can be handled; built-in ones (then the current handler will provide some "additional" handling); custom ones; and even third-party annotations are covered. A custom annotation doesn't necessarily have to be marked with something like <code>@AnnotationRendering</code>; the absence of the meta-annotation would only lead to the automapping not being performed.</p> <p><em>scope</em> is an optional property determining in what <a href="about:blank#custom-annotation-scope">scope</a> this handler will operate. If not specified, the scope will be decided on by querying for the <em>scope</em> of the handled annotation. The default is all applicable scopes.</p> <p><em>before</em> and <em>after</em> parameters allow for arranging the sequence of handling. If neither is specified, the handlers are executed in the following sequence: first the built-in handlers hooked to this annotation, then custom handlers, in alphabetical order by name.</p> <h3 id="source-object">Source object</h3> <p>The first argument of a handler's <code>accept</code> method is the <a href="https://javadoc.io/doc/com.exadel.etoolbox/etoolbox-authoring-kit-core/latest/com/exadel/aem/toolkit/api/handlers/Source.html" target="_blank" rel="noopener norefferer">Source</a>. This is a generic data provider that matches the entity (a Java class or a class member) the handler is called for. If the current handler is invoked due to an annotation attached to a class, the <em>Source</em> represents the class itself. But if the annotation was attached to a method or a field, the <em>Source</em> stands for the underlying member.</p> <p>The <em>Source</em> is further specified by calling the <code>adaptTo()</code> method that accepts the only argument: the adapter type. You can, for example, call <code>source.adaptTo(Annotation[].class)</code> to get the array of annotations attached to the source-reflected class or class member. Also, you can specify a particular annotation like <code>source.adaptTo(DialogField.class)</code>. If the referred annotation is not present, <code>null</code> is returned. To mitigate null pointer management you can call the <code>tryAdaptTo()</code> method that will return an <code>Optional</code> object.</p> <p>There are predefined source adapters. For instance, a source object can be adapted to <code>MemberSource</code> that has several properties specific for member-based sources (refer to this <a href="https://javadoc.io/doc/com.exadel.etoolbox/etoolbox-authoring-kit-core/latest/com/exadel/aem/toolkit/api/handlers/MemberSource.html" target="_blank" rel="noopener norefferer">javadoc</a> for details).</p> <p>You can create your own adapter that will encapsulate some reasonable logic. See the following code snippet which shows how to virtually turn a ToolKit annotation into a writable Java entity:</p> <pre><code class="language-java">
<span class="token annotation punctuation">@Adapts</span><span class="token punctuation">(</span><span class="token class-name">Source</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token comment">// Indicates the adaptable. For all source adaptations, the value should be "Source"</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WritableDialogField</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> ranking<span class="token punctuation">;</span>

    <span class="token comment">// Instance constructor *must* be public and accept the only argument - the instance of adaptable</span>
    <span class="token keyword">public</span> <span class="token class-name">WritableDialogField</span><span class="token punctuation">(</span><span class="token class-name">Source</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> source<span class="token punctuation">.</span><span class="token function">adaptTo</span><span class="token punctuation">(</span><span class="token class-name">DialogField</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ranking <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">adaptTo</span><span class="token punctuation">(</span><span class="token class-name">DialogField</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ranking<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getRanking</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> ranking<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRanking</span><span class="token punctuation">(</span><span class="token keyword">int</span> ranking<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ranking <span class="token operator">=</span> ranking<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Handles</span><span class="token punctuation">(</span><span class="token class-name">CustomAnnotation</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomHandler</span> <span class="token keyword">implements</span> <span class="token class-name">Handler</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">Source</span> source<span class="token punctuation">,</span> <span class="token class-name">Target</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> ranking <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">adaptTo</span><span class="token punctuation">(</span><span class="token class-name">DialogField</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ranking</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        source<span class="token punctuation">.</span><span class="token function">adaptTo</span><span class="token punctuation">(</span><span class="token class-name">WritableDialogField</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setRanking</span><span class="token punctuation">(</span>ranking <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <p>Adapter instances are retained for a <em>Source</em> through the handling chain. Therefore, you can assign values to custom adapters and be sure that the same value can be retrieved in, for example, another handler processing some other annotation attached to the same class or class member.</p> <h3 id="target-object">Target object</h3> <p>In a ToolKit's handler, <em>Target</em> stands for an abstraction of rendering a target. Each <em>Target</em> instance represents a future Granite UI entity or a corresponding XML node. It can have its attributes, a parent target, and an ordered collection of child targets (nodes) the same way that Granite/XML nodes do.</p> <p>The ToolKit API is designed in a way to make operation <em>Targets</em> more convenient than operation "bare" XML DOM entities. There are 40+ methods that comprise functional areas such as:</p> <ul> <li>Retrieving/setting of the (tag)name, prefix, and postfix;</li> <li>Retrieving/creating child targets by name or by relative path (multi-segment paths are supported);</li> <li>Traversing the targets tree upward and downward and finding a matching sub- or super-target by criteria;</li> <li>Moving, inserting, or deleting child targets;</li> <li>Setting an attribute to a target;</li> <li>Mapping a "whole" annotation to a target (its properties become the target's attributes);</li> <li>Removing attributes, etc.</li> </ul> <p>Consider the following example:</p> <pre><code class="language-java">
<span class="token annotation punctuation">@Handles</span><span class="token punctuation">(</span><span class="token class-name">CustomAnnotation</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomHandler</span> <span class="token keyword">implements</span> <span class="token class-name">Handler</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">Source</span> source<span class="token punctuation">,</span> <span class="token class-name">Target</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> memberName <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        target
            <span class="token punctuation">.</span><span class="token function">attributes</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span><span class="token function">adaptTo</span><span class="token punctuation">(</span><span class="token class-name">DialogField</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// maps all the props of @DialogField to target's attributes</span>
            <span class="token punctuation">.</span><span class="token function">attribute</span><span class="token punctuation">(</span><span class="token string">"processed"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>  <span class="token comment">// assigns a boolean-type attribute</span>
            <span class="token punctuation">.</span><span class="token function">attribute</span><span class="token punctuation">(</span><span class="token string">"sourceName"</span><span class="token punctuation">,</span> memberName<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">createChild</span><span class="token punctuation">(</span><span class="token string">"items"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// creates a child target by name</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            target<span class="token punctuation">.</span><span class="token function">getOrCreateChild</span><span class="token punctuation">(</span><span class="token string">"items/item"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span> <span class="token comment">// retrieves a child target by relative path</span>
                <span class="token punctuation">.</span><span class="token function">attribute</span><span class="token punctuation">(</span><span class="token string">"ordinal"</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// assigns a numeric attribute</span>
                <span class="token punctuation">.</span><span class="token function">attribute</span><span class="token punctuation">(</span><span class="token string">"intArray"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token keyword">long</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// assigns an array</span>
                <span class="token punctuation">.</span><span class="token function">createChild</span><span class="token punctuation">(</span><span class="token string">"subitem1"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// returns the parent node of the last processed node</span>
                <span class="token punctuation">.</span><span class="token function">createChild</span><span class="token punctuation">(</span><span class="token string">"subitem2"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">attribute</span><span class="token punctuation">(</span><span class="token string">"dateCreated"</span><span class="token punctuation">,</span> <span class="token class-name">Date</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>calendar<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInstant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// assigns a date</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Target</span> subitem0 <span class="token operator">=</span> testable<span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token string">"item0/subitem0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// traverses the target tree</span>
        <span class="token class-name">Target</span> subitem1 <span class="token operator">=</span> subitem0<span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token string">"../../item0/subitem0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ".." returns a parent target, or else the current one if the parent is null</span>

        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertNotNull</span><span class="token punctuation">(</span>testable<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '..' returns the current node if there's no parent</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">"subitem0"</span><span class="token punctuation">,</span> testable<span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token string">"item2/subitem2/../../item0/subitem0"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertNull</span><span class="token punctuation">(</span>testable<span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token string">"item2/subitem3/../../item0/subitem0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token constant">TIER_1_CHILD_COUNT</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> testable<span class="token punctuation">.</span><span class="token function">findChildren</span><span class="token punctuation">(</span>t <span class="token operator">-&gt;</span> t<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token constant">NN_SUBITEM</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> testable<span class="token punctuation">.</span><span class="token function">findChildren</span><span class="token punctuation">(</span>t <span class="token operator">-&gt;</span> t<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token constant">PN_ORDINAL</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"{Long}1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Target</span> subsubitem <span class="token operator">=</span> testable<span class="token punctuation">.</span><span class="token function">findChild</span><span class="token punctuation">(</span>t <span class="token operator">-&gt;</span> <span class="token operator">!</span>t<span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token string">"../../.."</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token string">"../.."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token constant">NN_SUBSUBITEM</span> <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">,</span> subsubitem<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">assertEquals</span><span class="token punctuation">(</span>testable<span class="token punctuation">,</span> subsubitem<span class="token punctuation">.</span><span class="token function">findParent</span><span class="token punctuation">(</span>t <span class="token operator">-&gt;</span> t<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token constant">NN_ROOT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <p>In this example, the <em>items</em> node is created within the given <em>target</em>. Then <em>items</em> are populated with subnodes, each having the <em>ordinal</em> attribute with the values 1.. 10. Each one will be given two children of its own with the names <em>subitem1</em> and <em>subitem2</em>.</p> <p>The following code would help retrieve a collection of nodes (regardless the nested level), the names of which end with "1":</p> <pre><code>List&lt;Target&gt; firstChildren = currentTarget.findChildren(t -&gt; t.getName().endsWith("1"))
</code></pre> <p>Next is the way to collect all the targets within the target tree that are grandchildren of nodes with the container resource type:</p> <pre><code>List&lt;Target&gt; containerDescendants = currentTarget.findChildren(t -&gt; StringUtils.defaultString(t.getTarget("../..").getAttribute("sling:resourceType")).equals("granite/ui/components/coral/foundation/container"));
</code></pre> <p>Another snippet shows how to retrieve an ancestor with a particular name:</p> <pre><code>Target root = currentTarget.findParent(t -&gt; t.getName().equals("jcr:root"))
</code></pre> <p>There are many more possibilities. For greater detail, see the inline documentation on <a href="https://javadoc.io/doc/com.exadel.etoolbox/etoolbox-authoring-kit-core/latest/com/exadel/aem/toolkit/api/handlers/Target.html" target="_blank" rel="noopener norefferer">Target</a>.</p> <p>Just like <em>Source</em>, <em>Target</em> is an adaptable entity. By default, <em>Target</em> adapts to <code>DomAdapter</code> with the possibility of being serialized to an XML DOM document. You can apply any custom adapters in the way described in the "Source object" section.</p> <h2 id="debugging-custom-plugin-logic">Debugging custom plugin logic</h2> <p>You can debug the ToolKit's plugin while building your AEM project. In order to do so, you need to:</p> <ol> <li>Make sure that the two projects are open each in its own window of your IDE:</li> </ol> <ul> <li>the Toolkit itself,</li> <li>and the "target" project (the one that contains the Toolkit plugin in its POM file).</li> </ul> <ol start="2"> <li>Launch the build of the <strong>target</strong> project with <code>mvndebug</code> instead of <code>mvn</code>. Do it like this:</li> </ol> <pre><code>mvnDebug clean install -PautoInstallPackage
</code></pre> <p>(Mind that the build won't technically start off before the next step. <code>mvnDebug</code> just establishes a listener service and waits for an incoming connection). 3) Switch to the ToolKit's IDE window. Start the remote debug session with <em>localhost</em> as the host and port <em>8000</em>. Most convenient is to create a new "Run/debug configuration" with these parameters in your IDE. The rest of the parameters will remain default. 4) Now the actual build process starts. You can set breakpoints in the plugin's code and operate as usual.</p> <p>Read more on debugging a Maven plugin e.g. <a href="https://spin.atomicobject.com/2020/08/20/maven-debugging-intellij/" target="_blank" rel="noopener norefferer">here</a>.</p> <h3 id="running-integration-tests">Running integration tests</h3> <p>The ToolKit supports integration tests powered by <a href="https://selenide.org/" target="_blank" rel="noopener norefferer">Selenide</a>. They are mainly for checking the browser-bound functions and rely on the connection to a live AEM server and/or 3rd-party services on the Internet.</p> <p>The integration tests are localed in the <code>it.tests</code> module. Important: unlike unit tests, integration tests are not run in frames of a "regular" build. To run them, you need to specify the dedicated Maven profile like the following:</p> <pre><code>mvn clean test -Pintegration
</code></pre> <p>As the integration tests start, a synthetic content package containing test data will be created and deployed to a live AEM instance (the one specified by the <em>aem.host</em> and/or <em>aem.port</em> properties). You can find the data in AEM under <em>/apps/etoolbox-authoring-kit-test</em> and also in the same folders under <em>/conf</em> and <em>/content</em>.</p> <p>If the live AEM instance is not available, the tests will fail.</p> <p>The login and password are needed to install the package. You may specify them with <em>aem.login</em> and <em>aem.password</em> properties if they are not the default <em>admin/admin</em> pair.</p> <p>After the integration tests are run, the synthetic package and its content are removed from the live AEM instance. You may, however, want them to stay, e.g., to manually re-run the test cases that failed. For that purpose, specify the <em>nouninstall=true</em> property either in the Maven file or in the command line.</p> <p>A complete command line for running integration tests with different properties specified may look like the following:</p> <pre><code>mvn clean test -Pintegration -D"aem.host"=192.168.0.81 -D"aem.port"=8080 -D"aem.login"=siteadmin -D"aem.password"=MyPa$$w0rd -Dnouninstall=true
</code></pre> <h3 id="doing-regression-testing">Doing regression testing</h3> <p>The ToolKit supports regression testing as well. Regression testing is done using an external AEM project. The aim is to make sure that a <newer> version of ToolKit (namely, the plugin) produces essentially the same XML markup as an <older> one. The <older> version is considered a "reference" and is used as a baseline for comparison.</older></older></newer></p> <p>To run regression tests, you need to specify the dedicated Maven profile like the following:</p> <pre><code>mvn test -Pregression "-Dproject=e:\projects\aem\my_project -Deak.version=${version}"
</code></pre> <p>The focus here is the <em>-Dproject=...</em> option. It is the command line to build the target project.</p> <p>The ToolKit will navigate to the folder e:\projects\aem\my_project_ (and expectedly will find project's POM file in it). It will build the project (without doing unit tests and deployment) with the version of ToolKit that is specified in the project. It will collect the content packages created upon the build.</p> <p>Then it will switch the version of ToolKit to the latest one and run the build for the second time. The content packages will be collected again. Then the "former" and the "newer" packages will be compared content-wise. If there are no significant disparities, the test is passed. Otherwise, the test is failed.</p> <p>We assume that your project has a <em>Maven property</em> that stores the version of ToolKit, and the dependencies within your project use that property (like <code>&lt;dependency&gt;&lt;groupId&gt;com.exadel.etoolbox&lt;/groupId&gt;&lt;artifactId&gt;...&lt;/artifactId&gt;&lt;version&gt;${eak.version}&lt;/dependency&gt;</code>). Name of the property does not matter. But you are expected to mention it in the <em>-Dproject=...</em> as shown above. The <em>${version}</em> part is the placeholder that will be used by the regression code.</p> <p>Within <em>-Dproject=...</em>, you can specify more property keys that are specific for your project if you need to. You can also specify the <em>-pl</em> option to select particular modules for the build, or also some <em>-P</em> keys to specify build profiles, etc. Do not forget to enclose <em>-Dproject=...</em> in double quotes if there are spaces inside.</p> <p>You can process more than one project at a time. Separate projects in the <em>-Dproject=...</em> option with a semicolon.</p> <p>We've said that the second part of the regression is building a target project with the current ToolKit version. If you however wish to test another version, specify it with the optional switch like <code>-Deak.version=1.2.3-SNAPSHOT</code>.`</p> <p>Besides, you can override the <em>Maven</em> executable used to build the target AEM project by specifying <code>-Dmaven.cmd=/path/to/mvn/or/a/cmd/file</code>. Optionally you can specify a local Maven repository address if it differs from <em>$HOME$/.m2</em>, with <code>-Dmaven.dir=/path/to/maven/repository</code>.</p> <h4 id="filtering-disparities">Filtering disparities</h4> <p>Certain disparities that may be found in regression testing are expected and, therefore, can be omitted. This is done with the <em>filters</em> option. A filter is a JavaScript file composed per the EToolbox-Coconut documentation.</p> <p>By default, the filters are looked for at the current project's path in the <code>eak.regression/filters</code> subdirectory. E.g., <code>/home/projects/my-aem-project/eak.regression/filters</code>.</p> <p>This subdirectory can contain another subdir that refers to the "older" and "newer" ToolKit's versions delimited with <em>-to-</em> like in the following example: <code>/home/projects/my-aem-project/eak.regression/filters/2.4.0-to-2.4.1-SNAPSHOT</code>. If such a subdirectory exists, the filters are borrowed from it. But if the there isn't a subdir matching the "older" and "newer" versions, the filters are borrowed from just <code>eak.regression/filters</code>.</p> <p>The comparison is done inside a temp folder. By default, the folder is erased after the regression is done. If you want to keep it, specify <code>-Dnocleanup=true</code>.</p> <h4 id="regression-tips">Regression tips</h4> <p>Be sure to <em>build</em> the ToolKit completely before doing the regression, or else include the <em>install</em> phase into the regression Maven run.</p> <p>Also, make sure that your target project(-s) are fully built with the newest changes, especially if you do regression with a selection of modules (via <em>-pl</em>). Otherwise there may occur a dependency resolution issue, or else some compilation errors.</p> </div> </main> <esl-scrollbar target="::prev" class="main-scroll"></esl-scrollbar> <div class="header-shadow"></div> </div> <script src="/bundles/site.js"></script>   </body>